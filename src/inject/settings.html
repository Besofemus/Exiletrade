<!DOCTYPE html>
<html>

  <style>
    
    div.et-settings
    {
	padding-bottom: 5px;
    }
    
    .et-keyedit
    {
	text-align: center;
    	width: 100px;
    }
    
    div.et-settings label
    {
	display: block;
	float: left;
	width: 80px;
	height: 15px;
    }
    
  </style>

  <div class="et-settings">
    <label>Settings</label>
    <input id="et-key-settings" class="et-keyedit" type="text">
  </div>
  
  <div class="et-settings">
    <label>Hide/Show</label>
    <input id="et-key-toggle_show" class="et-keyedit" type="text">
  </div>

  
  <script>

    const ipc = require("electron").ipcRenderer;

    
    let settings_field = document.getElementById("et-key-settings");
    
    settings_field.addEventListener("keydown", keyboard_listener("settings"));

    settings_field.addEventListener("keyup", () => {
	settings_field.blur();
    });

    ipc.on("keyedit:registered_settings",
	   function (e, keys_string)
	   {
	       settings_field.value = keys_string;
	   });


    let toggle_show_field = document.getElementById("et-key-toggle_show");
    

    
    toggle_show_field.addEventListener("keydown", keyboard_listener("toggle_show"));

    toggle_show_field.addEventListener("keyup", () => {
	toggle_show_field.blur();
    });

    ipc.on("keyedit:registered_toggle_show",
	   function (e, keys_string)
	   {
	       toggle_show_field.value = keys_string;
	   });

    
    
    function keyboard_listener (field_name)
    {
	return function (event)
	{
	    let key_string = "";
	    
	    if ((15 < event.keyCode && event.keyCode < 19)
    		|| event.key == "Meta") {
    		return;
    	    }

    	    if (event.shiftKey) { key_string += "Shift+"; }
    	    if (event.ctrlKey) { key_string += "Ctrl+"; }
    	    if (event.altKey) { key_string += "Alt+"; }
	    
    	    key_string += event.key.toUpperCase();
	    
    	    var keysequence = {
    		name: field_name,
    		string: key_string		
    	    }
    	    ipc.send("keyedit:add", keysequence);

    	};
    }
    
  </script>
</html>
