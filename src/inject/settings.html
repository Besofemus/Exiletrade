<!DOCTYPE html>
<html>

  <style>
    
    div.et-settings
    {
	padding-bottom: 5px;
    }
    
    .et-keyedit
    {
	text-align: center;
    	width: 100px;
    }
    
    div.et-settings label
    {
	display: block;
	float: left;
	width: 80px;
	height: 15px;
    }
    
  </style>

  <div class="et-settings">
    <label>Settings</label>
    <input id="et-key-settings" class="et-keyedit" type="text">
  </div>
  
  <div class="et-settings">
    <label>Hide/Show</label>
    <input id="et-key-toggle_show" class="et-keyedit" type="text">
  </div>

  
  <script>

    const ipc = require("electron").ipcRenderer;
    const resource = require("./resource.js");
    const hotkey = require("./hotkey.js");

    
    let settings_field = document.getElementById("et-key-settings");
    
    settings_field.addEventListener("keydown", keyboard_listener(resource.menu_name));

    settings_field.addEventListener("keyup", () => {
	settings_field.blur();
    });

    ipc.on(hotkey.registered_msg(resource.menu_name),
	   function (e, sequence)
	   {
	       settings_field.value = sequence;
	   });


    let toggle_show_field = document.getElementById("et-key-toggle_show");
    
    toggle_show_field.addEventListener("keydown", keyboard_listener(resource.toggle_name));

    toggle_show_field.addEventListener("keyup", () => {
	toggle_show_field.blur();
    });

    ipc.on(hotkey.registered_msg(resource.toggle_name),
	   function (e, sequence)
	   {
	       toggle_show_field.value = sequence;
	   });

    
    
    function keyboard_listener(field_name)
    {
	return function (event)
	{
	    let sequence = "";
	    
	    if ((15 < event.keyCode && event.keyCode < 19)
    		|| event.key == "Meta") {
    		return;
    	    }
	    
    	    if (event.shiftKey) { sequence += "Shift+"; }
    	    if (event.ctrlKey) { sequence += "Ctrl+"; }
    	    if (event.altKey) { sequence += "Alt+"; }
	    
    	    sequence += event.key.toUpperCase();
	    
    	    ipc.send(hotkey.add_msg(), field_name, sequence);

    	};
    }
    
  </script>
</html>
